# 教师作业评价小程序 - 软件框架技术文档

## 1.0 项目概述

### 1.1 项目目标

本项目旨在开发一款基于uni-app的微信小程序，为师生提供一个便捷的音视频作业提交与评价平台。系统需支持学生通过移动端提交多种格式的作业，并能让教师高效地完成查阅、评价与打分，同时集成初步的自动化分析能力以辅助教学。

### 1.2 设计原则

- **快速迭代 (Rapid Development):** 优先采用一体化的技术栈和成熟的解决方案，最大限度地缩短开发周期，快速上线核心功能。
- **高扩展性 (High Extensibility):** 架构设计必须具备良好的前瞻性，易于横向扩展以支持未来海量用户，并能方便地集成第三方AI服务。
- **可维护性 (Maintainability):** 采用模块化、服务化的代码组织方式，确保代码结构清晰、职责分明，降低长期维护成本。
- **成本效益 (Cost-Effective):** 充分利用Serverless（无服务器）架构的优势，在项目初期及中小规模阶段，实现极低的运营成本。

### 1.3 文档受众

本文档主要面向项目开发者、架构师及技术管理者，作为项目开发、迭代和维护的核心技术指导。

## 2.0 技术选型 (Tech Stack)

| 模块         | 技术方案                  | 核心理由                                                     |
| ------------ | ------------------------- | ------------------------------------------------------------ |
| **前端框架** | **uni-app (基于 Vue 3)**  | **跨平台核心**：一套代码，多端发布。初期聚焦小程序，未来可零成本扩展至App，提供更优的视频处理能力。Vue 3的组合式API（Composition API）更利于组织复杂逻辑。 |
| **后端架构** | **uniCloud (Serverless)** | **开发速度核心**：前后端一体化开发，无需管理服务器。使用前端熟悉的JavaScript即可开发后端，极大提升效率。底层基于阿里云/腾讯云，性能与稳定性有保障。 |
| **数据库**   | **uniCloud DB**           | **灵活性核心**：内置的文档型数据库， schemaless（无固定结构）特性非常适合敏捷开发和需求快速变更。与云函数无缝集成，性能优异。 |
| **文件存储** | **uniCloud 云存储**       | **大文件核心**：专为音视频等大文件设计。支持客户端直传，不占用服务器带宽，安全可靠。自带CDN加速，保证全球师生流畅访问。 |
| **状态管理** | **Pinia**                 | **可维护性核心**：Vue 3官方推荐的状态管理器，语法简洁，对TypeScript支持友好，能有效管理用户登录状态、数据列表等全局状态。 |
| **用户认证** | **uni-id-pages**          | **安全与速度核心**：DCloud官方出品的用户认证解决方案，开箱即用，快速实现包括微信授权登录在内的安全用户体系。 |

## 3.0 整体系统架构

系统采用经典的前后端分离的Serverless架构。

**架构解析:**

1. **客户端 (Client):** 运行在用户手机微信中的uni-app小程序。负责UI展示、用户交互和数据采集。
2. **接入层 (Gateway):** uniCloud作为统一的后端网关，处理所有来自客户端的请求。
3. **服务层 (Service Layer):** 后端核心逻辑，以**云对象 (Cloud Objects)** 的形式组织。每个云对象负责一个独立的业务领域（如用户、作业、评价），实现高内聚。
4. **数据层 (Data Layer):** 使用uniCloud DB进行业务数据存储，使用云存储进行用户文件（音视频）的持久化。
5. **第三方服务 (3rd Party Services):** 通过云函数与外部AI服务（如发音评测、内容审核API）进行交互，实现功能的无限扩展。

## 4.0 项目目录结构 (前端)

一个清晰的目录结构是项目可维护性的基石。推荐采用以下结构：

```
/
├── api/                  # 后端API请求封装层
│   ├── homework.js       # 作业相关接口
│   └── user.js           # 用户相关接口
├── components/           # 可复用的UI组件
│   ├── homework-card/    # 作业卡片组件
│   └── file-uploader/    # 文件上传组件
├── pages/                # 主包页面
│   ├── student/          # 学生角色页面
│   │   ├── submit.vue    # 作业提交页
│   │   └── list.vue      # 我的作业列表
│   ├── teacher/          # 教师角色页面
│   │   ├── list.vue      # 待评价作业列表
│   │   └── detail.vue    # 作业详情与评价页
│   └── login.vue         # 登录页
├── static/               # 静态资源 (图片等)
├── store/                # Pinia状态管理
│   ├── index.js          # 主入口
│   └── user.js           # 用户信息store
├── uni_modules/          # uni-app插件
│   └── uni-id-pages/     # 用户认证插件
├── utils/                # 工具函数
│   ├── constants.js      # 全局常量
│   └── request.js        # 网络请求拦截器 (可选)
├── main.js               # Vue主入口
└── App.vue               # 应用配置
```

## 5.0 后端架构 (uniCloud)

后端逻辑将存放于`uniCloud/cloudfunctions`目录，推荐使用**云对象**进行组织。

### 5.1 云对象 (Cloud Objects) 设计

相比于零散的云函数，云对象能更好地组织业务逻辑，实现面向对象的开发。

- **`user-service` (用户服务对象):**
  - `login(code)`: 处理用户登录和注册。
  - `getInfo()`: 获取当前用户信息。
  - `updateProfile(data)`: 更新用户信息。
- **`homework-service` (作业服务对象):**
  - `create(data)`: 创建新的作业提交记录。
  - `getListForTeacher()`: 获取教师名下的待评价作业列表。
  - `getListForStudent()`: 获取学生自己的作业列表。
  - `getDetail(id)`: 获取单个作业的详细信息。
- **`evaluation-service` (评价服务对象):**
  - `submit(data)`: 教师提交评价。

### 5.2 数据库集合 (Collections) 设计

1. **users (用户表):**
   - `_id`: 用户ID
   - `nickname`: 昵称
   - `avatar`: 头像
   - `role`: 角色数组 `['student', 'teacher']` (支持一人多角色)
   - `student_info`: { `teacher_ids`: ['teacher_id_1', ...] } (学生信息，包含其所有教师)
   - `teacher_info`: { ... } (教师信息)
2. **homework-submissions (作业提交表):**
   - `_id`: 提交ID
   - `student_id`: 学生ID
   - `teacher_id`: 教师ID
   - `title`: 标题
   - `description`: 文字说明
   - `files`: 文件列表 `[{ name: 'xxx', url: 'cloud://...', type: 'video' }]`
   - `status`: 状态 ('submitted', 'evaluated')
   - `preliminary_evaluation`: { `text`: '系统初步评价...', `source`: 'text-analysis' }
   - `create_date`: 提交时间
3. **evaluations (评价表):**
   - `_id`: 评价ID
   - `submission_id`: 关联的作业ID
   - `teacher_id`: 评价的教师ID
   - `student_id`: 被评价的学生ID
   - `score`: 分数
   - `feedback_text`: 文字评语
   - `feedback_audio_url`: 语音评语URL (可扩展)
   - `create_date`: 评价时间

### 5.3 核心业务流程：学生提交作业

这是一个关键流程，涉及前后端、数据库和云存储的协同工作。

1. **前端**: 用户在`submit.vue`页面填写表单，并使用`uni.chooseMedia`选择视频文件。
2. **前端**: 调用`uniCloud.uploadFile`将视频**直接上传**到云存储。此过程不经过后端服务器，效率最高。
3. **前端**: 上传成功后，获取到文件的`fileID` (即云存储地址)。
4. **前端**: 将`fileID`连同表单的其他数据（标题、说明等）一起，调用`homework-service`云对象的`create`方法。
5. **后端**: `create`方法执行，进行数据校验（权限、内容等），然后将作业信息写入`homework-submissions`集合。
6. **后端 (触发器)**: 在`homework-submissions`集合上设置一个**数据库触发器**。当有新记录被创建时，自动触发一个名为`auto-evaluate`的云函数。
7. **后端 (AI)**: `auto-evaluate`云函数获取新作业的文本内容，进行初步分析，并将结果更新回该作业记录的`preliminary_evaluation`字段。
8. **前端**: 接收到`create`方法成功的返回，提示用户“提交成功”。

## 6.0 扩展性设计

本架构为未来的功能扩展预留了清晰的接口。

- **AI集成**:
  - 只需修改`auto-evaluate`云函数即可。
  - **发音评测**: 在该函数中，获取作业的音频文件URL，通过HTTP请求将其发送给第三方英语评测API。接收到评测结果（JSON格式）后，解析并存入数据库的一个新字段中。前端只需读取并展示该字段即可。
  - **视频分析**: 同理，可调用视频内容审核、人脸识别等API。
- **用户量扩展 (10W级)**:
  - **数据库**: 为`homework-submissions`等集合的关键查询字段（如`student_id`, `teacher_id`, `status`）创建索引，这是数据库性能优化的第一步。
  - **Serverless**: uniCloud的云函数和数据库本身就是按量付费、自动伸缩的，天然具备应对高并发的能力。您只需关注业务代码，无需担心服务器扩容。
  - **成本管理**: 最大的成本增长点将是**云存储**和**CDN流量**。需要规划好存储策略（如冷热数据分离）和监控流量费用。

## 7.0 总结

本框架方案以**uni-app + uniCloud**为核心，构建了一个高度一体化、易于快速开发和维护的系统。它通过Serverless架构解决了传统后端开发的复杂性和高成本问题，同时通过模块化和分层设计，为项目未来的功能扩展和用户量增长提供了坚实可靠的保障。开发者可以聚焦于业务逻辑的实现，高效地交付一款高质量的教育小程序产品。