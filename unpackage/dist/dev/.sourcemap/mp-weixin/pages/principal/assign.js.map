{"version":3,"file":"assign.js","sources":["pages/principal/assign.vue","../../../../../TOOL/TOOL/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJpbmNpcGFsL2Fzc2lnbi52dWU"],"sourcesContent":["<template>\n\t<view class=\"container\">\n\t\t<uni-segmented-control :current=\"currentTab\" :values=\"['分配教师', '教师-学生管理']\" @clickItem=\"onClickItem\" style-type=\"button\" active-color=\"#007aff\" />\n\n\t\t<view class=\"content\" v-if=\"currentTab === 0\">\n\t\t\t<view class=\"section\">\n\t\t\t\t<text class=\"section-title\">1. 选择教师 (可多选)</text>\n\t\t\t\t<checkbox-group @change=\"teacherChange\">\n\t\t\t\t\t<label class=\"item\" v-for=\"teacher in teachers\" :key=\"teacher._id\">\n\t\t\t\t\t\t<checkbox :value=\"teacher._id\" /> <text>{{ teacher.nickname }}</text>\n\t\t\t\t\t</label>\n\t\t\t\t</checkbox-group>\n\t\t\t</view>\n\t\t\t<view class=\"section\">\n\t\t\t\t<text class=\"section-title\">2. 为学生进行分配</text>\n\t\t\t\t<uni-list>\n\t\t\t\t\t<uni-list-item v-for=\"student in students\" :key=\"student._id\">\n\t\t\t\t\t\t<template v-slot:body>\n\t\t\t\t\t\t\t<view class=\"student-item\">\n\t\t\t\t\t\t\t\t<view class=\"student-info\">\n\t\t\t\t\t\t\t\t\t<text class=\"student-name\">{{ student.nickname }}</text>\n\t\t\t\t\t\t\t\t\t<text class=\"teacher-info\">当前教师: {{ student.teachers_info.map(t=>t.nickname).join(', ') || '暂无' }}</text>\n\t\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t\t\t<button class=\"assign-btn\" size=\"mini\" type=\"primary\" @click=\"assign(student._id)\">分配</button>\n\t\t\t\t\t\t\t</view>\n\t\t\t\t\t\t</template>\n\t\t\t\t\t</uni-list-item>\n\t\t\t\t</uni-list>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<view class=\"content\" v-if=\"currentTab === 1\">\n\t\t\t<view class=\"section\" v-for=\"teacher in teachers\" :key=\"teacher._id\">\n\t\t\t\t<text class=\"section-title teacher-header\">{{ teacher.nickname }} 的学生</text>\n\t\t\t\t<view class=\"tag-container\">\n\t\t\t\t\t<uni-tag v-for=\"student in getStudentsForTeacher(teacher._id)\" :key=\"student._id\" :text=\"student.nickname\" type=\"primary\" :inverted=\"true\" />\n\t\t\t\t\t<text v-if=\"getStudentsForTeacher(teacher._id).length === 0\" class=\"no-student\">暂无学生</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { getTeachersApi, getStudentsWithTeachersApi, assignTeachersApi } from '../../api/principal.js';\n\nconst currentTab = ref(0);\nconst teachers = ref([]);\nconst students = ref([]);\nconst selectedTeacherIds = ref([]);\n\nonMounted(loadData);\n\nasync function loadData() {\n\tuni.showLoading({ title: '加载数据中...' });\n\ttry {\n\t\t// 【核心修正】直接接收云对象返回的数据\n\t\tconst [teacherRes, studentRes] = await Promise.all([getTeachersApi(), getStudentsWithTeachersApi()]);\n\t\tteachers.value = teacherRes;\n\t\tstudents.value = studentRes;\n\t} catch (e) { handleError(e); } finally { uni.hideLoading(); }\n}\n\nfunction onClickItem(e) { if (currentTab.value !== e.currentIndex) currentTab.value = e.currentIndex; }\nfunction teacherChange(e) { selectedTeacherIds.value = e.detail.value; }\n\nasync function assign(studentId) {\n\tif (selectedTeacherIds.value.length === 0) {\n\t\tuni.showToast({ title: '请至少选择一位教师', icon: 'none' });\n\t\treturn;\n\t}\n\tuni.showLoading({ title: '分配中...' });\n\ttry {\n\t\tawait assignTeachersApi({ studentId, teacherIds: selectedTeacherIds.value });\n\t\tuni.showToast({ title: '分配成功' });\n\t\t// 【核心修正】直接接收云对象返回的数据\n\t\tstudents.value = await getStudentsWithTeachersApi();\n\t} catch (e) { handleError(e); } finally { uni.hideLoading(); }\n}\n\nfunction getStudentsForTeacher(teacherId) {\n\treturn students.value.filter(s => (s.teacher_ids || []).includes(teacherId));\n}\n\nfunction handleError(e) { uni.showModal({ title: '错误', content: e.message, showCancel: false }); }\n</script>\n\n<style scoped>\n.container { padding: 10px; }\n.content { margin-top: 15px; }\n.section { margin-top: 20px; }\n.section-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; display: block; padding-left: 5px; }\n.teacher-header { color: #007aff; border-left: 3px solid #007aff; }\n.item { display: flex; align-items: center; padding: 5px; }\n.student-item { display: flex; justify-content: space-between; align-items: center; width: 100%;}\n.student-info { display: flex; flex-direction: column; }\n.student-name { font-size: 16px; }\n.teacher-info { font-size: 12px; color: #999; }\n.tag-container { display: flex; flex-wrap: wrap; }\n.no-student { font-size: 14px; color: #999; }\n</style>","import MiniProgramPage from 'D:/share_dir/product_env/git_repo/HomeworkReviewer/HomeworkReviewer/pages/principal/assign.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onMounted","uni","getTeachersApi","getStudentsWithTeachersApi","assignTeachersApi"],"mappings":";;;;;;;;;;;;;;;;;;AA+CA,UAAM,aAAaA,cAAAA,IAAI,CAAC;AACxB,UAAM,WAAWA,cAAAA,IAAI,CAAA,CAAE;AACvB,UAAM,WAAWA,cAAAA,IAAI,CAAA,CAAE;AACvB,UAAM,qBAAqBA,cAAAA,IAAI,CAAA,CAAE;AAEjCC,kBAAS,UAAC,QAAQ;AAElB,mBAAe,WAAW;AACzBC,oBAAAA,MAAI,YAAY,EAAE,OAAO,WAAY,CAAA;AACrC,UAAI;AAEH,cAAM,CAAC,YAAY,UAAU,IAAI,MAAM,QAAQ,IAAI,CAACC,6BAAgB,GAAEC,yCAA4B,CAAA,CAAC;AACnG,iBAAS,QAAQ;AACjB,iBAAS,QAAQ;AAAA,MACnB,SAAU,GAAG;AAAE,oBAAY,CAAC;AAAA,MAAE;AAAaF,sBAAAA,MAAI,YAAW;AAAA,MAAK;AAAA,IAC/D;AAEA,aAAS,YAAY,GAAG;AAAE,UAAI,WAAW,UAAU,EAAE;AAAc,mBAAW,QAAQ,EAAE;AAAA,IAAe;AACvG,aAAS,cAAc,GAAG;AAAE,yBAAmB,QAAQ,EAAE,OAAO;AAAA,IAAQ;AAExE,mBAAe,OAAO,WAAW;AAChC,UAAI,mBAAmB,MAAM,WAAW,GAAG;AAC1CA,sBAAG,MAAC,UAAU,EAAE,OAAO,aAAa,MAAM,OAAM,CAAE;AAClD;AAAA,MACA;AACDA,oBAAAA,MAAI,YAAY,EAAE,OAAO,SAAU,CAAA;AACnC,UAAI;AACH,cAAMG,cAAAA,kBAAkB,EAAE,WAAW,YAAY,mBAAmB,MAAK,CAAE;AAC3EH,sBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAE/B,iBAAS,QAAQ,MAAME,cAAAA;MACzB,SAAU,GAAG;AAAE,oBAAY,CAAC;AAAA,MAAE;AAAaF,sBAAAA,MAAI,YAAW;AAAA,MAAK;AAAA,IAC/D;AAEA,aAAS,sBAAsB,WAAW;AACzC,aAAO,SAAS,MAAM,OAAO,QAAM,EAAE,eAAe,CAAE,GAAE,SAAS,SAAS,CAAC;AAAA,IAC5E;AAEA,aAAS,YAAY,GAAG;AAAEA,oBAAG,MAAC,UAAU,EAAE,OAAO,MAAM,SAAS,EAAE,SAAS,YAAY,MAAK,CAAE;AAAA,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACpFlG,GAAG,WAAW,eAAe;"}